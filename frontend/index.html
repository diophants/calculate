<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Calculate</title>
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700&family=Montserrat:wght@400;700&family=Roboto:wght@100;300;400;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="display">
      <div class="result">
        <p id="output" class="p-result">0</p>
      </div>
      <div class="inputs">
        <div class="left-operators">
          <div class="top-operators">
            <button>AC</button>
            <button class="plus-minus">&#x207a;&#x2044;&#x208b;</button>
            <button class="percent">%</button>
          </div>
          <div class="numbers">
            <button>7</button>
            <button>8</button>
            <button>9</button>
            <button>4</button>
            <button>5</button>
            <button>6</button>
            <button id="1">1</button>
            <button id="2">2</button>
            <button>3</button>
            <button class="zero">0</button>
            <button class="comma">&#x2C</button>
          </div>
        </div>
        <div class="right-operators">
          <button>&#247</button>
          <button class="mult">&times</button>
          <button id="minus">-</button>
          <button id="plus">+</button>
          <button id="equally">=</button>
        </div>
      </div>
    </div>
    <script>
      const socket = new WebSocket('ws://localhost:3001')
      let cells = []
      
      const output = document.getElementById('output')
      const input1 = document.getElementById('1')
      const input2 = document.getElementById('2')
      const plus = document.getElementById('plus')
      const equally = document.getElementById('equally')
      
      socket.addEventListener('message', ({data}) => {
        const change = JSON.parse(data)
        cells = change.cells
        if (cells.length !== 1) output.textContent = cells.join('')
        else output.textContent = cells
      })

      const calculation = (arr) => {
        const expression = arr.join('')
        const res = eval(expression)
        return res
      } 

      input1.addEventListener('click', () => {
        cells.push(1)
        output.textContent = cells.join('')
        socket.send(JSON.stringify({
          value: '1',
          cells,
        }))
      });
      input2.addEventListener('click', () => {
        cells.push(2)
        output.textContent = cells.join('')
        socket.send(JSON.stringify({
          value: '2',
          cells,
        }))
      })
      plus.addEventListener('click', () => {
        if (cells[cells.length - 1] === '+') return
        if (cells.length === 0) cells.push(0)
        cells.push('+')
        output.textContent = cells.join('')
        socket.send(JSON.stringify({
          value: '+',
          cells,
        }))
      })
      
      minus.addEventListener('click', () => {
        if (cells[cells.length - 1] === '-') return
        if (cells.length === 0) cells.push(0)
        cells.push('-')
        output.textContent = cells.join('')
        socket.send(JSON.stringify({
          value: '-',
          cells,
        }))
      })
      
      equally.addEventListener('click', () => {
        if (typeof cells[cells.length - 1] !== 'number') return
        cells = [calculation(cells)]
        output.textContent = cells
        socket.send(JSON.stringify({
          value: '=',
          cells,
        }))
      })
    </script>
  </body>
</html>
